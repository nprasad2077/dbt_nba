---
version: 2
models:
  - name: int_player_performance
    description: "Unified model containing basic and advanced stats for each player
      in every game. Grain: one row per player per game."
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - game_id
            - player_id
    columns:
      - name: game_id
        description: Foreign key to the game.
        tests:
          - not_null
      - name: player_id
        description: Foreign key to the player.
        tests:
          - not_null
  - name: int_team_performance
    description: "Unified model containing basic and advanced stats for each team in
      every game. Grain: one row per team per game."
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - game_id
            - team
    columns:
      - name: game_id
        description: Foreign key to the game.
        tests:
          - not_null
      - name: team
        description: Team abbreviation.
        tests:
          - not_null
  - name: int_games_enriched
    description: "Game-level model enriched with detailed performance stats for both
      the home and visitor teams. Grain: one row per game."
    columns:
      - name: game_id
        description: Primary key for the game.
        tests:
          - unique
          - not_null
      - name: home_team
        description: Home team abbreviation, foreign key to int_team_performance.
        tests:
          - not_null
          - relationships:
              to: ref('int_team_performance')
              field: team
      - name: visitor_team
        description: Visiting team abbreviation, foreign key to int_team_performance.
        tests:
          - not_null
          - relationships:
              to: ref('int_team_performance')
              field: team
              
  - name: int_player_shots_enriched
    description: >
      Unified shot-level dataset combining field goal attempts (from shot charts)
      with free throw attempts (derived from stg_player_game_basic_stats).
      Game ID is resolved via date + team + opponent matching.

      FT rows have quarter_number = 0 and shot_source = 'box_score_ft'.
      FG rows have full court location/timing and shot_source = 'shot_chart'.

      This ensures: FG points + FT points = actual game points.
      Grain: one row per shot attempt (FG or FT).
    columns:
      - name: shot_id
        description: >
          Unique shot identifier. Positive values are source IDs from shot_chart.
          Negative values are deterministic synthetic IDs for box-score-derived FTs.
        tests:
          - not_null
      - name: game_id
        description: >
          Resolved game_id from matching on date/team/opponent.
          NULL if no matching game was found in the games table.
      - name: player_id
        description: Basketball-Reference player ID
        tests:
          - not_null
      - name: team
        description: Conformed team abbreviation
        tests:
          - not_null
      - name: opponent
        description: Conformed opponent abbreviation
        tests:
          - not_null
      - name: has_game_match
        description: Whether this shot was successfully matched to a game_id
      - name: shot_source
        description: >
          Origin of the shot record.
          'shot_chart' = field goal from shot chart data.
          'box_score_ft' = free throw derived from box score basic stats.
        tests:
          - not_null
          - accepted_values:
              values: ['shot_chart', 'box_score_ft']
      - name: quarter_number
        description: >
          Quarter number (1-4 for regulation, 5 for OT, 0 for box-score-derived FTs
          where timing is unknown)
      - name: is_free_throw
        description: Whether this shot is a free throw attempt
