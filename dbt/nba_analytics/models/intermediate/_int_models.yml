---
version: 2
models:
  - name: int_player_performance
    description: "Unified model containing basic and advanced stats for each player
      in every game. Grain: one row per player per game."
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - game_id
            - player_id
    columns:
      - name: game_id
        description: Foreign key to the game.
        tests:
          - not_null
      - name: player_id
        description: Foreign key to the player.
        tests:
          - not_null
  - name: int_team_performance
    description: "Unified model containing basic and advanced stats for each team in
      every game. Grain: one row per team per game."
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - game_id
            - team
    columns:
      - name: game_id
        description: Foreign key to the game.
        tests:
          - not_null
      - name: team
        description: Team abbreviation.
        tests:
          - not_null
  - name: int_games_enriched
    description: "Game-level model enriched with detailed performance stats for both
      the home and visitor teams. Grain: one row per game."
    columns:
      - name: game_id
        description: Primary key for the game.
        tests:
          - unique
          - not_null
      - name: home_team
        description: Home team abbreviation, foreign key to int_team_performance.
        tests:
          - not_null
          - relationships:
              to: ref('int_team_performance')
              field: team
      - name: visitor_team
        description: Visiting team abbreviation, foreign key to int_team_performance.
        tests:
          - not_null
          - relationships:
              to: ref('int_team_performance')
              field: team
  - name: int_player_shots_enriched
    description: >
      Shot chart data enriched with game_id resolution and conformed team
      abbreviations. Joins shots to games using date + team + opponent matching.
      Grain: one row per shot attempt. Includes has_game_match flag for quality.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - shot_id
    columns:
      - name: shot_id
        description: Unique shot identifier
        tests:
          - unique
          - not_null
      - name: game_id
        description: >
          Resolved game_id from matching on date/team/opponent.
          NULL if no matching game was found in the games table.
      - name: player_id
        description: Basketball-Reference player ID
        tests:
          - not_null
      - name: team
        description: Conformed team abbreviation
        tests:
          - not_null
      - name: opponent
        description: Conformed opponent abbreviation
        tests:
          - not_null
      - name: has_game_match
        description: Whether this shot was successfully matched to a game_id
